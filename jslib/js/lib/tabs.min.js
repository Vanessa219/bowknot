!function(t){t.fn.extend({tabs:{version:"0.0.1.7",author:"lly219@gmail.com"}});var e=(new Date).getTime(),i="tabs",n=function(){this._defaults={styleClass:{leftSelected:"tabs-left-selected",rightSelected:"tabs-right-selected",left:"tabs-left",right:"tabs-right",leftSelectedRight:"tabs-left-selected-right",leftRight:"tabs-left-right",leftRightSelected:"tabs-left-right-selected",middle:"tabs-middle",middleSelected:"tabs-middle-selected",nav:"tabs-nav",content:"tabs-content",tabsBG:"tabs-tabs-bg",closeIcon:"tabs-close-icon",hover:"tabs-hover"}}};t.extend(n.prototype,{_attach:function(e,n){e.id||(this.uuid++,e.id="dp"+this.uuid);var s=this._newInst(t(e));s.settings=t.extend({length:0},n||{}),t.data(e,i,s),this._init(e)},_newInst:function(t){var e=t[0].id.replace(/([^A-Za-z0-9_])/g,"\\\\$1");return{id:e}},_getInst:function(e){try{return t.data(e,i)}catch(n){throw"Missing instance data for this tabs"}},_init:function(e){var i=this._getInst(e),n=i.id,s=i.settings,a=this._getDefaults(this._defaults,s,"styleClass"),d=void 0;if(e.className=a.tabsBG,s.data){var l=s.height?" style='height:"+s.height+"px;'":"";e.innerHTML="<ul class='"+a.nav+"'></ul>",t(e).after("<div id='"+n+"Content' class='"+a.content+"'"+l+"></div>"),this._buildHTML(e),d=t(e).find("li")}else{d=t(e).find("li"),s.data=[],t(e).find("ul").addClass(a.nav);var r=t("#"+n+"Content div"),h=t("#"+n+"Content");h.addClass(a.content),s.height&&h.height(s.height);for(var c=0;c<d.length;c++)s.data[c]={},s.data[c].text=d.get(c).innerHTML,s.data[c].content=r.get(c).innerHTML,s.data[c].id=t(d.get(c).children[0]).data("index"),c!==d.length-1?d.get(c).innerHTML="<div></div>"+d.get(c).innerHTML:d.get(c).innerHTML="<div></div>"+d.get(c).innerHTML+"<div></div>"}this._setCurrentTab(e,s.data[0].id),this._changeTab(e,d),this._close(e,d),this._bindEvent(e,d),"function"==typeof s.load&&s.load()},_buildHTML:function(e){for(var i=this._getInst(e),n=i.settings,s=i.id,a=n.data,d="",l="",r=0;r<a.length;r++){var h={};h=this._buildTabPanelHTML(e,a[r]),d+=h.tabHTML,l+=h.contentHTML}t(e).find("ul").html(d),t("#"+s+"Content").html(l)},_buildTabPanelHTML:function(t,e){var i=this._getInst(t),n=i.settings,s=i.id,a=this._getDefaults(this._defaults,n,"styleClass"),d=n.data,l="",r="",h="",c=e.text,o=e.alt?e.alt:e.text;e.altCount&&e.altCount<c.length&&c.indexOf("</")<0&&(c=c.substr(0,e.altCount)+"..."),c+=e.button?"<span id='"+s+"_"+e.id+"_button'>"+e.button+"</span>":"",d[d.length-1].id===e.id.toString()&&(h="<div></div>"),l=e.isClose?"<li><div></div><div data-index='"+e.id+"' title='"+o+"'><span class='left'>"+c+"</span><a  href='javascript:void(0);' class='"+a.closeIcon+"'></a></div>"+h+"</li>":"<li><div></div><div data-index='"+e.id+"' title='"+o+"'>"+c+"</div>"+h+"</li>";var g=s+"_"+e.id,f=e.content;if(e.url){var u=this._calculateIframeHeight(n.height,s);f="<iframe id='"+g+"_iframe' src='"+e.url+"' frameborder='0' width='100%' height='"+u+"' style='height:"+u+";'></iframe>"}return r="<div id='"+g+"'>"+f+"</div>",{tabHTML:l,contentHTML:r}},_changeTab:function(e,i,n){void 0!==n?t(i.get(n)).bind("click",function(){t.tabs._changeTabFunction(this,e)}).mouseover(function(){this.className="hover"}).mouseout(function(){this.className=""}):i.each(function(){t(this).bind("click",function(){t.tabs._changeTabFunction(this,e)})}).mouseover(function(){this.className="hover"}).mouseout(function(){this.className=""})},_changeTabFunction:function(e,i){var n=this._getInst(i),s=this._getDefaults(this._defaults,n.settings,"styleClass"),a=t(t(e).find("div")[1]);a.hasClass(s.middleSelected)||this._setCurrentTab(i,a.data("index"))},_setCurrentTab:function(e,i){for(var n=this._getInst(e),s=n.settings,a=s.data,d=this._getDefaults(this._defaults,s,"styleClass"),l=t(e).find("li"),r=0;r<a.length;r++){var h=t("#"+e.id+"_"+a[r].id);t("#"+n.id+"_"+a[r].id+"_button").hide(),i.toString()===a[r].id?(0===r?(l.get(r).children[0].className=d.leftSelected,1===a.length&&(l.get(r).children[2].className=d.rightSelected)):r===a.length-1?(l.get(r).children[0].className=d.leftRightSelected,l.get(r).children[2].className=d.rightSelected):l.get(r).children[0].className=d.leftRightSelected,l.get(r).children[1].className=d.middleSelected,a[r].reload&&!a[r].content&&(document.getElementById(a[r].id+"Iframe").contentWindow.location.href=a[r].url),h.show(),t("#"+n.id+"_"+a[r].id+"_button").show()):(0===r?l.get(r).children[0].className=d.left:(i.toString()===a[r-1].id?l.get(r).children[0].className=d.leftSelectedRight:l.get(r).children[0].className=d.leftRight,r===a.length-1&&(l.get(r).children[2].className=d.right)),l.get(r).children[1].className=d.middle,h.hide())}},_bindEvent:function(e,i,n){var s=this._getInst(e),a=s.settings,d=a.bind,l=a.data;if(a.bind)if(void 0!==n)for(var r=0;r<d.length;r++)t(i.get(n)).bind(d[r].type,{data:l[n],index:r},function(t){d[t.data.index].action(t,t.data.data)});else for(var h=0;h<l.length;h++)for(var c=0;c<d.length;c++)t(i.get(h)).bind(d[c].type,{data:l[h],index:c},function(t){d[t.data.index].action(t,t.data.data)})},_close:function(e,i,n){var s=this._getInst(e),a=this._getDefaults(this._defaults,s.settings,"styleClass");void 0!==n?t(i[n]).find("."+a.closeIcon).bind("click",function(i){t.tabs._closeFunction(e,t(i.currentTarget.parentNode).data("index"))}):i.find("."+a.closeIcon).bind("click",function(i){t.tabs._closeFunction(e,t(i.currentTarget.parentNode).data("index"))})},_closeFunction:function(e,i){var n=this._getInst(e),s=n.settings,a=s.data,d=this._getDefaults(this._defaults,n.settings,"styleClass"),l=t(e).find("li"),r=this._getIndexById(a,i.toString());if("function"!=typeof s.close||s.close(a[r])){t("#"+e.id+"_"+i).remove();var h=t(t(l.get(r-1)).find("div")[1]);r===a.length-1&&(h.hasClass(d.middleSelected)?h.after("<div class='"+d.rightSelected+"'></div>"):h.after("<div class='"+d.right+"'></div>")),r===a.length-2&&h.hasClass(d.middleSelected)&&(l.get(r+1).children[0].className=d.leftSelectedRight),t(l.get(r)).remove(),a.splice(r,1),t(t(l.get(r)).find("div")[1]).hasClass(d.middleSelected)&&(0===r&&r++,this._setCurrentTab(e,a[r-1].id)),i.currentTarget&&i.stopPropagation()}},_getDefaults:function(t,e,i){if("styleClass"===i){if("default"===e.theme||void 0===e.theme)return t.styleClass;e.styleClass={};for(var n in t[i])e.styleClass[n]=t.styleClass[n]+"-"+e.theme}else{if("height"===i&&"auto"!==e[i]||"width"===i)return null===e[i]||void 0===e[i]?t[i]+"px":e[i]+"px";if(null===e[i]||void 0===e[i])return t[i]}return e[i]},_calculateIframeHeight:function(e,i){var n=t("#"+i+"Content"),s=n.css("padding-top"),a=n.css("padding-bottom");return e-parseInt(s)-parseInt(a)+"px"},_getIndexById:function(t,e){for(var i in t)if(t[i].id===e)return parseInt(i)},_addTabs:function(e,i){var n=this._getInst(e),s=n.settings,a=s.data;i.id=i.id.replace(/(^\s*)|(\s*$)/g,"").toString();var d=a.length;if("function"==typeof s.add){var l=s.add(i);if(!l)return}if(s.size&&a.length>=s.size)return void alert("对不起，只能打开"+s.size+"个窗口");for(var r=0;r<a.length;r++)if(a[r].id===i.id)return void this._setCurrentTab(e,i.id);s._count++,a.splice(d,0,i),i.id?a[d].id=i.id:a[d].id=n.id+"Content"+s._count;var h=this._buildTabPanelHTML(e,a[d]);a.length-1===d&&t(e).find("ul li div").last().remove(),0===d?t(t(e).find("li").get(d)).before(h.tabHTML):t(t(e).find("li").get(d-1)).after(h.tabHTML),t("#"+n.id+"Content").append(h.contentHTML);var c=t(e).find("li");this._setCurrentTab(e,a[d].id),this._changeTab(e,c,d),this._close(e,c,d),this._bindEvent(e,c,d)},_lengthTabs:function(t){var e=this._getInst(t);return e.settings.data.length},_selectTabs:function(t,e){this._setCurrentTab(t,e)},_removeTabs:function(e,i){var n=this._getInst(e),s=n.settings,a=this._getDefaults(this._defaults,s,"styleClass"),d=t(e).find("li");s.closeSyn?d.find("#"+i+" ."+a.closeIcon).click():this._closeFunction(e,i)},_getTabTabs:function(e,i,n){var s=this._getInst(e),a=s.settings,d=a.data,l=this._getDefaults(this._defaults,a,"styleClass"),r={},h=0;if(i?(h=this._getIndexById(d,i),r=d[h]):t(e).find("li").each(function(e){var i=t(this);t(i.find("div")[1]).hasClass(l.middleSelected)&&(r=d[e],h=e)}),n)switch(h=parseInt(h),n){case"next":h<d.length-1&&(r=d[h+1]);break;case"pre":h>0&&(r=d[h-1]);break;default:alert("get tab error, has no type!")}return r},_destroyTabs:function(e){var n=t(e),s=this._getInst(e),a=s.settings,d=this._getDefaults(this._defaults,a,"styleClass");t.removeData(e,i),n.removeClass(d.tabsBG).empty(),t("#"+s.id+"Content").remove()},_updateTabs:function(e,i,n){var s=this._getInst(e),a=s.settings,d=t(e).find("li"),l=a.data;if(void 0!==n){var r=this._getIndexById(l,n),h=i.altCount?i.altCount:l[r].altCount,c=i.url?i.url:l[r].url,o=i.text?i.text:l[r].text,g=o,f=t("#"+s.id+"_"+l[r].id);h<o.length&&o.indexOf("</")<0&&(o=o.substr(0,h)+"..."),l[r].isClose?t(t(d[r]).find("span")[0]).html(o).attr("title",g):t(t(d.get(r)).find("div")[1]).html(o).attr("title",g),i.content&&f.html(i.content),i.url&&(t("#"+s.id+"_"+l[r].id+"_iframe").attr("src",c).width(f.width()),setTimeout(function(){t("#"+s.id+"_"+l[r].id+"_iframe").width("100%")},500)),t.extend(l[r],i)}else{t.extend(a,i),t("#"+e.id+"Content").height(i.height);for(var u=a.data,_=0;_<u.length;_++){var v=t("#"+s.id+"_"+u[_].id+"_iframe");u[_].url&&1===v.length&&(v.height(i.height),v.attr("height",i.height))}}},_bindTabs:function(e,i,n){var s=this._getInst(e),a=s.settings.data,d=this._getIndexById(a,n);a[d].bind=i;for(var l=t(t(e).find("li").get(d)),r=0;r<i.length;r++)l.bind(i[r].type,{data:a[d]},i[r].action)},_unbindTabs:function(e,i,n){var s=this._getInst(e),a=this._getIndexById(s.settings.data,n),d=s.settings.data[a].bind;for(var l in d)d[l].type===i&&t(t(e).find("li").get(a)).unbind(i,d[l].action)}}),t.fn.tabs=function(e){var i=Array.prototype.slice.call(arguments);return"string"==typeof e?(i.shift(),t.tabs["_"+e+"Tabs"].apply(t.tabs,[this[0]].concat(i))):this.each(function(){t.tabs._attach(this,e)})},t.tabs=new n,window["DP_jQuery_"+e]=t}(jQuery);