!function(t){t.fn.extend({table:{version:"0.0.1.1",author:"lly219@gmail.com"}});var e=(new Date).getTime(),i="table",a=function(){this._defaults={styleClass:{lineSelectedClass:"table-selected",mainClass:"table-main",bodyClass:"table-body",headerClass:"table-header",lineHoverClass:"table-lineHover",sortClass:"table-sort",sortASCClass:"table-sortASC",sortDESCClass:"table-sortDESC",sortUnASCClass:"table-sortUnactiveASC",sortUnDESCClass:"table-sortUnactiveDESC",oddRowClass:"table-oddRow",evenRowClass:"table-evenRow"}}};t.extend(a.prototype,{_attach:function(e,a){e.id||(this.uuid++,e.id="dp"+this.uuid);var s=this._newInst(t(e));s.settings=t.extend({noDataTip:"no data!",selectedRows:[]},a||{}),t.data(e,i,s),this._init(e)},_newInst:function(t){var e=t[0].id.replace(/([^A-Za-z0-9_])/g,"\\\\$1");return{id:e}},_getInst:function(e){try{return t.data(e,i)}catch(a){throw"Missing instance data for this table"}},_init:function(e){var i=this._getInst(e);t(e).html("<div class='"+this._defaults.styleClass.mainClass+"' id='"+i.id+"Table'></div>"),this._build(e)},_build:function(e){var i=this._getInst(e),a=i.settings,s=this._defaults.styleClass,l=i.id,n="<div id='"+l+"TableHeader' class='"+s.headerClass+"'></div><div id='"+l+"TableMain' class='"+s.bodyClass+"' style='"+(a.height?"height: "+a.height+"px":"")+"'></div>";t("#"+l+"Table").html(n),this._buildHeader(e),this._buildBody(e),this._bindEvent(e)},_buildHeader:function(e){for(var i=this._getInst(e).settings,a=i.colModel,s=this._getInst(e).id,l="<table cellpadding='0' cellspacing='0' style='width:100%'><tr>",n=0;n<a.length;n++){var d=s+"_"+a[n].index;l+=a[n].minWidth?"<th style='min-width:"+a[n].minWidth+"px;'>":"<th style='width:"+a[n].width+"px;'>",l+="checkbox"===a[n].type?a[n].isLabel?a[n].text:"<input id='"+d+"' type='checkbox'/></th>":"<span id='"+d+"'>"+a[n].text?a[n].text:"</span></th>"}t("#"+s+"TableHeader").html(l+"<th style='width:0; border-right: 0'></th></tr></table>")},_buildBody:function(e){var i=this._getInst(e).id,a=this._getInst(e).settings,s=a.data,l="";l+="<table style='width:100%;' cellpadding='0' cellspacing='0'>"+this._buildData(e,s)+"</table>",t("#"+i+"TableMain").html(l),t("#"+i+"TableMain").height()<t("#"+i+"TableMain>table").height()&&t("#"+i+"TableHeader th").last().width(16)},_buildData:function(e,i){var a=this._getInst(e).id,s=this._getInst(e).settings,l=s.colModel,n=this._defaults.styleClass;if(0===i.length)return"<tbody><tr><td align='center' colspan='"+l.length+"'>"+s.noDataTip+"</td></tr></tbody>";for(var d="<colgroup>",r=0;r<l.length;r++)d+=l[r].minWidth?"<col style='"+(l[r].minWidth?"min-width:"+l[r].minWidth+"px;":"")+"'></col>":"<col style='"+(l[r].width?"width:"+l[r].width+"px;":"")+"'></col>";d+="</colgroup><tbody>";for(var o=0;o<i.length;o++){var h=i[o],c="",b=n.oddRowClass;o%2===1&&(b=n.evenRowClass);for(var g="<tr class="+b+">",u=0;u<l.length;u++){var _=l[u].index,f=h[_],v=l[u].align?"text-align:"+l[u].align+";":"";if((void 0===f||null===f||""===t.trim(f))&&(f="&nbsp;"),g+="<td><div style="+v+">",l[u].type){var p="",y=a+"_"+_+"_"+o;p="<input data-id='"+h.id+"' id='"+y+"' type='"+l[u].type+"'>",f=p}g+=f+"</div></td>"}d+=c+g+"</tr>"}return d+"</tbody>"},_bindEvent:function(e){for(var i=this._getInst(e).id,a=this._getInst(e).settings.colModel,s=this,l="",n=0;n<a.length;n++)"checkbox"===a[n].type&&(l=a[n].index);t("#"+i+"_"+l).click(function(){s._selectHeaderCheckbox(i,this)}),t("#"+i+"TableMain input").click(function(){s._selectCheckbox(i,l,this)})},_selectHeaderCheckbox:function(e,a){t("#"+e+"TableMain input").prop("checked",a.checked);var s=t("#"+e).data(i).settings,l=s.selectedRows,n=s.data;if(a.checked){for(var d=0;d<n.length;d++)l.push(n[d].id);t("#"+e+"TableMain tr").addClass("table-selected")}else{for(var d=0;d<n.length;d++)for(var r=0;r<l.length;r++)if(l[r]===n[d].id){l.splice(r,1);break}t("#"+e+"TableMain tr").removeClass("table-selected")}t.unique(l)},_selectCheckbox:function(e,a,s){var l=t(s).parents("tr"),n=t("#"+e).data(i).settings,d=n.selectedRows;if(s.checked)d.push(t(s).data("id").toString()),l.addClass("table-selected");else{for(var r=0;r<d.length;r++)if(d[r]===t(s).data("id").toString()){d.splice(r,1);break}l.removeClass("table-selected")}var o=0;t("#"+e+"TableMain input").each(function(){this.checked&&(o+=1)}),t("#"+e+"TableMain tr").length===o?t("#"+e+"_"+a).prop("checked",!0):t("#"+e+"_"+a).prop("checked",!1),t.unique(d)},_getSelectedRowsTable:function(t){for(var e=this._getInst(t).settings,i=e.data,a=e.selectedRows,s=[],l=0;l<i.length;l++)for(var n=0;n<a.length;n++)if(a[n]===i[l].id){s.push(i[l]);break}return s},_setSelectedRowsTable:function(e,i){for(var a=this._getInst(e).settings,s=this._getInst(e).id,l=a.data,n=t("#"+s+"TableMain input"),d=0;d<i.length;d++)for(var r=0;r<l.length;r++)if(i[d]===l[r].id){n.get(r).checked||n.get(r).click();break}},_updateTable:function(t,e,i){},_destroyTable:function(e){var a=this._getInst(e);t.removeData(e,i),t("#"+a.id).remove()}}),t.fn.table=function(e){var i=Array.prototype.slice.call(arguments);return"string"==typeof e?(i.shift(),t.table["_"+e+"Table"].apply(t.table,[this[0]].concat(i))):this.each(function(){t.table._attach(this,e)})},t.table=new a,window["DP_jQuery_"+e]=t}(jQuery);