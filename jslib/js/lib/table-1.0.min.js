!function($){$.fn.extend({table:{version:"0.0.8.0",author:"lly219@gmail.com"}});var dpuuid=(new Date).getTime(),PROP_NAME="table",SCROLLBAR_WIDTH=17,Table=function(){this._defaults={height:"auto",resizable:!1,caption:"Table mock data",styleClass:{highlightClass:"table-heiglight",mainClass:"table-main",bodyClass:"table-body",headerClass:"table-header",verticalLineClass:"table-verticalLine",lineHoverClass:"table-lineHover",sortClass:"table-sort",sortASCClass:"table-sortASC",sortDESCClass:"table-sortDESC",sortUnASCClass:"table-sortUnactiveASC",sortUnDESCClass:"table-sortUnactiveDESC",floatLayerIconClass:"table-floatLayerIcon",oddRowClass:"table-oddRow",evenRowClass:"table-evenRow",subTitleClass:"table-subTitle",subTitleShowClass:"table-subTitleShow",subTitleHideClass:"table-subTitleHide"},theme:"default",bindColumnEvent:[{eventName:"",functionName:""}],currentIndex:""},this._settingsDataFormat={data:[],colModel:[{name:"",index:"",width:90,minWidth:50,textAlign:"left",sortType:"string",bindEvent:[{evenName:"",funcitonName:""}],floatLayer:"id",inputType:"",allSelected:!1,visible:!0,style:"",sortEvent:""}]}};$.extend(Table.prototype,{_attach:function(t,e){t.id||(this.uuid++,t.id="dp"+this.uuid);var a=this._newInst($(t));a.settings=$.extend({},e||{}),$.data(t,PROP_NAME,a),this._init(t)},_newInst:function(t){var e=t[0].id.replace(/([^A-Za-z0-9_])/g,"\\\\$1");return{id:e}},_getInst:function(t){try{return $.data(t,PROP_NAME)}catch(e){throw"Missing instance data for this table"}},_destroyTable:function(){},_updateTable:function(t,e){var a=this._getInst(t),s=a.settings;for(var l in e)"string"==typeof e[l]||"number"==typeof e[l]||"data"===l?s[l]=e[l]:s[l]=$.extend(s[l],e[l]);this._build(t)},_init:function(t){var e=this._getInst(t),a=e.settings;$(t).append("<div class='"+$.table._getDefaults($.table._defaults,a,"styleClass").mainClass+"' id='"+e.id+"Table'></div>"),this._build(t)},_build:function(t){var e=this._getInst(t),a=e.settings,s=$.table._getDefaults($.table._defaults,a,"resizable"),l=$.table._getDefaults($.table._defaults,a,"styleClass"),i=$.table._getDefaults($.table._defaults,a,"height"),n=this._getTableWidth(a.colModel),d=s?"<div class='"+l.verticalLineClass+"' id='"+e.id+"VerticalLine'></div>":"",o=d+"<div id='"+e.id+"TableHeader' class='"+l.headerClass+"'></div><div id='"+e.id+"TableMain' class='"+l.bodyClass+"'></div>";$("#"+e.id+"Table").html(o).css("position","relative"),this._buildHeader(t),(a.data||a.subData)&&(this._buildBody(t,$.table._strToInt(i)),this._bindEvent(t),this._bindRowEvent(t)),"100%"===n.width?($("#"+e.id+"TableMain").css({"min-width":n.minWidth}),$("#"+e.id+"TableHeader").css({"min-width":n.minWidth}),$("#"+e.id+"TableMain").attr("offsetHeight")>$.table._strToInt(i)&&"7.0"!==$.browser.version&&$("#"+e.id+"TableHeader").css("padding-right",SCROLLBAR_WIDTH-1)):$("#"+e.id+"TableMain").attr("offsetHeight")>$.table._strToInt(i)?(document.getElementById(e.id+"TableMain").style.width=n.width+SCROLLBAR_WIDTH+"px",document.getElementById(e.id+"TableHeader").style.width=n.width+"px"):(document.getElementById(e.id+"TableMain").style.width=n.width+"px",document.getElementById(e.id+"TableHeader").style.width=n.width+"px"),parseInt(i)>=0&&(document.getElementById(e.id+"TableMain").style.height=i),s&&"100%"!==n.width&&($("#"+e.id+"VerticalLine").height($("#"+e.id+"TableHeader").height()+(a.height?a.height:$("#"+e.id+"TableMain").height())),$("#"+e.id+"Table").bind("mousemove",{target:t},this._mousemoveTabel).bind("mousedown",{target:t},this._mousedownVerticalLine))},_buildHeader:function(t){var e=this._getInst(t).settings,a=e.colModel,s=this._getInst(t).id,l=$.table._getDefaults($.table._defaults,e,"styleClass"),i=this._getTableWidth(a),n="<table cellpadding='0' cellspacing='0'><tr>",d='<div class="'+l.sortASCClass+" "+l.sortUnASCClass+'"></div><div class="'+l.sortDESCClass+" "+l.sortUnDESCClass+'"></div>';"100%"===i.width&&(n="<table cellpadding='0' cellspacing='0' style='width:100%'><tr>");for(var o=0;o<a.length;o++)if(void 0===a[o].visible){var r=s+"_"+a[o].index;n+=a[o].minWidth?"<th style='min-width:"+a[o].minWidth+"px;'>":"<th style='width:"+a[o].width+"px;'>",n+=a[o].sortType||a[o].sortEvent?"<span id='"+r+"'>"+a[o].name+'</span><span class="'+l.sortClass+'" id="'+r+'TableSort">'+d+"</span></th>":"checkbox"===a[o].inputType&&a[o].allSelected?"<input id='"+r+"' onclick=\"DP_jQuery_"+dpuuid+".table._selectHeaderCheckbox(this,'"+l.highlightClass+"');\" type='"+a[o].inputType+"'/></th>":"<span id='"+r+"'>"+a[o].name+"</span></th>"}$("#"+s+"TableHeader").html(n+"</tr></table>");for(var b=0;b<a.length;b++)(a[b].sortType||a[b].sortEvent)&&$("#"+s+"_"+a[b].index+"TableSort").bind("click",{index:a[b].index,target:t},$.table._sort)},_buildBody:function(t,e){var a=this._getInst(t).id,s=this._getInst(t).settings,l=s.subData,i=$.table._getDefaults($.table._defaults,s,"styleClass"),n={},d="",o="",r=[];if(l)for(var b=0;b<l.length;b++)n=this._buildTableBody(t,b),o=a+"subTitle",d+="<div class='"+i.subTitleClass+"'><div id='"+o+b+"' class='bowknot-left "+i.subTitleHideClass+"'></div><div class='bowknot-left'>"+l[b].title+"</div><div class='bowknot-clear'></div></div>"+n.bodyHTML;else n=this._buildTableBody(t,-1),d=n.bodyHTML;r=s.data?s.data:$.table._buildSubData(s.subData),$("#"+a+"TableMain").html(d);var u=$("#"+a+"TableMain").attr("offsetHeight");if(l)for(var c=0;c<l.length;c++)$("#"+o+c).click(function(){var t=this.id.split("subTitle")[1];$(this).hasClass(i.subTitleHideClass)?($("#"+a+"subTable"+t).hide(),u-$("#"+a+"subTable"+t).height()<=e&&$("#"+a+"TableHeader").css("padding-right",0),this.className="bowknot-left "+i.subTitleShowClass):($("#"+a+"subTable"+t).show(),u>e&&$("#"+a+"TableHeader").css("padding-right",SCROLLBAR_WIDTH-1),this.className="bowknot-left "+i.subTitleHideClass)});if(""!==n.checkAllId){var h=$.table._getInvisibleData(s.colModel,r,n.checkedArray);for(var g in h)$("#"+n.checkAllId).data(g,h[g])}},_buildTableBody:function(t,e){var a=this._getInst(t).id,s=this._getInst(t).settings,l=s.colModel,i="",n=[],d=$.table._getDefaults($.table._defaults,s,"styleClass"),o=$.table._getTableWidth(l),r="<table id='"+a+"subTable"+e+"' cellpadding='0' cellspacing='0'>",b=[],u=0;b=-1!==e?s.subData[e].data:s.data;for(var c=0;e>c;c++)u+=s.subData[c].data.length;"100%"===o.width&&(r="6.0"===$.browser.version?"<table id='"+a+"subTable"+e+"' style='width:auto;' cellpadding='0' cellspacing='0'>":"<table id='"+a+"subTable"+e+"' style='width:100%;' cellpadding='0' cellspacing='0'>");for(var h=0;h<b.length;h++){var g=b[h],v=0,f="",_="",p=d.oddRowClass;h%2===1&&(p=d.evenRowClass),f+='<tr class="$CLASS"  onmouseover="DP_jQuery_'+dpuuid+".table._mouseoverRow(this, '"+d.lineHoverClass+"', '"+d.highlightClass+'\');" onmouseout="DP_jQuery_'+dpuuid+".table._mouseoutRow(this, '"+d.lineHoverClass+"');\">";for(var C in g){var y=l[v].index;for(var m in g)if(y===m&&void 0===l[v].visible){var T=g[m],w=l[v].textAlign?"text-align:"+l[v].textAlign+";":"";if(_+=0===h?l[v].minWidth?"<td style='min-width:"+l[v].minWidth+"px;"+w+"'>":"<td style='width:"+l[v].width+"px;"+w+"'>":"<td style='"+w+"'>","checkbox"===l[v].inputType){var I="",E="",D="",M=a+"_"+m+"_"+(h+u);i=a+"_"+m,b[h][m].value&&(E="checked='checked'",f=f.replace("$CLASS",d.highlightClass+" "+p),n.push(h+u)),b[h][m].disabled&&(D="disabled='disabled'"),I="<input id='"+M+"' type='"+l[v].inputType+"' onclick=\"DP_jQuery_"+dpuuid+".table._selectCheckbox(this, '"+d.highlightClass+"');\" "+E+" "+D+"/>",T=I}if(l[v].floatLayer){var x="",S=l[v].floatLayerEvent?l[v].floatLayerEvent+"();":"";if(x="<div class='"+d.floatLayerIconClass+"' onmouseover=\"DP_jQuery_"+dpuuid+".table._bindShowData('"+l[v].floatLayer+"', '"+a+"','"+(h+u)+"');"+S+"DP_jQuery_"+dpuuid+".table._show(this, '"+l[v].floatLayer+'\');"  onmouseout="DP_jQuery_'+dpuuid+".table._hide('"+l[v].floatLayer+"');\"></div>",T=x+T,h+u===0){var L=document.getElementById(l[v].floatLayer),A="<"+L.tagName+" class='"+L.className+"' id='"+l[v].floatLayer+"Table'>"+$("#"+l[v].floatLayer).html()+"</"+L.tagName+">";$("#"+a+"Table").append(A),$("#"+l[v].floatLayer+"Table").mouseover(function(){$(this).show()}).mouseout(function(){$(this).hide()})}}l[v].style&&(T="<div style='"+l[v].style+"'>"+T+"</div>"),_+=T+"</td>"}v++}r+=f.replace("$CLASS",p)+_+"</tr>"}return{bodyHTML:r+"</table>",checkAllId:i,checkedArray:n}},_getTableWidth:function(t){for(var e={width:1,minWidth:0},a=!1,s=0;s<t.length;s++)t[s].visible!==!1&&(t[s].minWidth?(e.minWidth+=t[s].minWidth+1,e.width="100%",a=!0):t[s].width&&(e.minWidth+=t[s].width+1,a?e.width="100%":e.width+=t[s].width+1));return e},_bindEvent:function(target){var inst=$.table._getInst(target),id=inst.id,settings=inst.settings,colModel=inst.settings.colModel,data=[];data=settings.data?settings.data:$.table._buildSubData(settings.subData);for(var i=0;i<colModel.length;i++)if(colModel[i].bindEvent)for(var j=0;j<data.length;j++)for(var bindElement=$($($($("#"+id+"TableMain tr").get(j)).find("td")).get(i)),keys=$.table._getInvisibleData(colModel,data,[j]),k=0;k<colModel[i].bindEvent.length;k++)colModel[i].inputType?bindElement.find("input").bind(colModel[i].bindEvent[k].eventName,keys,eval(colModel[i].bindEvent[k].functionName)):bindElement.bind(colModel[i].bindEvent[k].eventName,keys,eval(colModel[i].bindEvent[k].functionName))},_buildSubData:function(t){for(var e=[],a=0;a<t.length;a++)for(var s=0;s<t[a].data.length;s++)e.push(t[a].data[s]);return e},_bindRowEvent:function(target){var settings=$.table._getInst(target).settings,id=$.table._getInst(target).id,bindRowEvent=settings.bindRowEvent;if(bindRowEvent){var colModel=settings.colModel,data=[];data=settings.data?settings.data:$.table._buildSubData(settings.subData);for(var i=0;i<data.length;i++)for(var bindElement=$($("#"+id+"TableMain tr").get(i)),keys=$.table._getInvisibleData(colModel,data,[i]),j=0;j<bindRowEvent.length;j++)"function"==typeof bindRowEvent[j].action?bindElement.bind(bindRowEvent[j].eventName,keys,bindRowEvent[j].action):bindElement.bind(bindRowEvent[j].eventName,keys,eval(bindRowEvent[j].functionName))}},_getInvisibleData:function(t,e,a){for(var s={},l=0;l<t.length;l++)if(t[l].visible===!1){for(var i=[],n=0;n<a.length;n++)i.push(e[a[n]][t[l].index]);s[t[l].index]=i}return s},_selectRow:function(t,e,a){},_mouseoverRow:function(t,e,a){$(t).hasClass(a)||$(t).addClass(e)},_mouseoutRow:function(t,e){$(t).removeClass(e)},_sort:function(event){for(var index=event.data.index,target=event.data.target,settings=$.table._getInst(target).settings,id=this.id.split("_")[0],data=settings.data,colModel=settings.colModel,styleClass=$.table._getDefaults($.table._defaults,settings,"styleClass"),sortType="",divs="#"+this.id+" .",currentColModel=void 0,p=0;p<colModel.length;p++)colModel[p].index===index?(sortType=colModel[p].sortType,currentColModel=colModel[p]):($("#"+id+"_"+colModel[p].index+"TableSort ."+styleClass.sortASCClass).addClass(styleClass.sortUnASCClass),$("#"+id+"_"+colModel[p].index+"TableSort ."+styleClass.sortDESCClass).addClass(styleClass.sortUnDESCClass));if($(divs+styleClass.sortASCClass).hasClass(styleClass.sortUnASCClass)&&$(divs+styleClass.sortDESCClass).hasClass(styleClass.sortUnDESCClass)||$(divs+styleClass.sortASCClass).hasClass(styleClass.sortUnASCClass)&&!$(divs+styleClass.sortDESCClass).hasClass(styleClass.sortUnDESCClass)){if(currentColModel.sortEvent)eval(currentColModel.sortEvent)("ASC");else for(var i=1;i<=data.length;i++)for(var j=0;j<data.length-i;j++){var temp=data[j],tempIndex=$.table._getsortType(temp[index],sortType),dataIndex=$.table._getsortType(data[j+1][index],sortType);tempIndex>dataIndex&&(data[j]=data[j+1],data[j+1]=temp)}$(divs+styleClass.sortASCClass).removeClass(styleClass.sortUnASCClass),$(divs+styleClass.sortDESCClass).addClass(styleClass.sortUnDESCClass)}else{if(currentColModel.sortEvent)eval(currentColModel.sortEvent)("DESC");else for(var k=1;k<=data.length;k++)for(var l=0;l<data.length-k;l++){var tempAsc=data[l],tempIndexAsc=$.table._getsortType(tempAsc[index],sortType),dataIndexAsc=$.table._getsortType(data[l+1][index],sortType);dataIndexAsc>tempIndexAsc&&(data[l]=data[l+1],data[l+1]=tempAsc)}$(divs+styleClass.sortASCClass).addClass(styleClass.sortUnASCClass),$(divs+styleClass.sortDESCClass).removeClass(styleClass.sortUnDESCClass)}var height=$.table._getDefaults($.table._defaults,settings,"height");settings.data&&!currentColModel.sortEvent&&($.table._buildBody(target,$.table._strToInt(height)),$.table._bindEvent(target),$.table._bindRowEvent(target))},_getsortType:function(t,e){return"int"===e?parseInt(t):"float"===e?parseFloat(t):t},_mousemoveTabel:function(t){window.attachEvent&&t.preventDefault();var e=t.data.target,a=$.table._getInst(e),s=a.id,l=a.settings.colModel,i=t.clientX-document.getElementById(s).offsetLeft-$.table._getPadding(s)+$("#"+s+"Table").scrollLeft(),n=$.table._isAtColumnSide(i,e),d=0,o=0;for($("#"+s+"VerticalLine").css("left",i);d<l.length&&""!==$.table._defaults.currentIndex;d++){if(l[d].index===$.table._defaults.currentIndex){o+=$("#"+s+"_"+l[d].index).width()+16;break}o+=l[d].width+1}o>i&&$("#"+s+"VerticalLine").css("left",o),n.show?$("#"+s+"Table").css("cursor","col-resize"):$("#"+s+"Table").css("cursor","default")},_mousedownVerticalLine:function(t){var e=t.data.target,a=$.table._getInst(e).id,s=t.clientX-document.getElementById(a).offsetLeft-$.table._getPadding(a)+$("#"+a+"Table").scrollLeft(),l=$.table._isAtColumnSide(s,e);$.table._defaults.currentIndex=l.index,$("#"+a+"Table").unbind("mouseup",$.table._mouseupVerticalLine),l.show?(window.addEventListener&&t.preventDefault(),$("#"+a+"Table").css("cursor","col-resize").bind("mouseup",{target:e,index:l.index},$.table._mouseupVerticalLine),$("#"+a+"VerticalLine").show()):$("#"+a+"Table").unbind("mouseup",$.table._mouseupVerticalLine)},_mouseupVerticalLine:function(t){var e=t.data.target,a=t.data.index,s=$.table._getInst(e).id,l=$.table._getInst(e).settings,i=$("#"+s+"VerticalLine").css("left"),n=l.colModel,d=$.table._strToInt(i),o=0,r=0;for($("#"+s+"VerticalLine").hide(),$("#"+s+"Table").css("cursor","default");o<n.length;o++){if(n[o].index===a){n[o].width=d;break}d=d-1-n[o].width}r=$("#"+s+"TableMain").attr("scrollHeight")!==$("#"+s+"TableMain").attr("clientHeight")?$.table._getTableWidth(n).width+SCROLLBAR_WIDTH:$.table._getTableWidth(n).width,$($("#"+s+"TableHeader th").get(o)).width(d);for(var b=$("#"+s+"TableMain table"),u=0;u<b.length;u++)$($($(b[u]).find("tr").get(0)).find("td").get(o)).width(d);$("#"+s+"TableHeader").width(r),$("#"+s+"TableMain").width(r)},_isAtColumnSide:function(t,e){for(var a=$.table._getInst(e).id,s=$.table._getInst(e).settings.colModel,l={show:!1,index:""},i=0,n=0;n<s.length;n++)if(i+=$($("#"+a+"TableMain tr").first().find("td").get(n)).width()+1,l.show=l.show||t===i||t===i+1||t===i-1,l.show)return l.index=s[n].index,l;return l},_bindShowData:function(t,e,a){var s=$("#"+e).data(PROP_NAME).settings,l=[];l=s.data?s.data:$.table._buildSubData(s.subData);var i=$.table._getInvisibleData(s.colModel,l,[a]);for(var n in i)$("#"+t).data(n,i[n])},_show:function(t,e){var a=$(t).position();$("#"+e+"Table").show().html($("#"+e).html()).css({left:a.left+22,top:a.top+6})},_hide:function(t){$("#"+t+"Table").hide()},_selectHeaderCheckbox:function(t,e){var a=t.id.split("_"),s=a[0],l=a[1],i=$("#"+s).data(PROP_NAME).settings,n=i.data,d=i.colModel,o=[];n=i.data?i.data:$.table._buildSubData(i.subData);for(var r=0;r<d.length;r++)if(d[r].index===l)for(var b=0;b<n.length;b++){var u=s+"_"+l+"_"+b,c=document.getElementById(u);t.checked?(n[b][l].disabled&&n[b][l].value||!n[b][l].disabled)&&(n[b][l].value=!0,$("#"+u).attr("checked","checked"),o.push(b),c.parentNode.parentNode.className.indexOf(e)<0&&(c.parentNode.parentNode.className=c.parentNode.parentNode.className+" "+e)):n[b][l].disabled&&n[b][l].value?o.push(b):(n[b][l].value=!1,$("#"+u).removeAttr("checked"),c.parentNode.parentNode.className=c.parentNode.parentNode.className.replace(e,""))}var h=$.table._getInvisibleData(i.colModel,n,o);for(var g in h)$(t).data(g,h[g])},_selectCheckbox:function(t,e){var a=t.id.split("_"),s=a[0],l=a[1],i=a[2],n=s+"_"+l,d=$("#"+s).data(PROP_NAME).settings,o=d.colModel,r=[],b=t.parentNode.parentNode.className,u=[];r=d.data?d.data:$.table._buildSubData(d.subData),r[i][l].value=t.checked;for(var c=0;c<r.length;c++)r[c][l].value&&u.push(c);var h=$.table._getInvisibleData(o,r,u);for(var g in h)$("#"+n).data(g,h[g]);t.checked?t.parentNode.parentNode.className=b+" "+e:t.parentNode.parentNode.className=b.replace(e,""),u.length===r.length?$("#"+n).attr("checked","checked"):$("#"+n).removeAttr("checked")},_getMarginPadding:function(t){var e=$.table._strToInt(document.getElementById(t).style.marginLeft),a=$.table._strToInt(document.getElementById(t).style.paddingLeft);return""===document.getElementById(t).style.marginLeft&&(e=0),""===document.getElementById(t).style.paddingLeft&&(a=0),e+a},_getPadding:function(t){var e=$.table._strToInt(document.getElementById(t).style.paddingLeft);return""===document.getElementById(t).style.paddingLeft&&(e=0),e},_getDefaults:function(t,e,a){if("styleClass"===a){if("default"===e.theme||void 0===e.theme)return t.styleClass;e.styleClass={};for(var s in t[a])e.styleClass[s]=e.theme+"-"+t.styleClass[s]}else if("height"===a||"width"===a){if(null===e[a]||void 0===e[a])return"auto"!==t[a]?t[a]+"px":t[a];if("auto"!==e[a])return e[a]+"px"}else if(null===e[a]||void 0===e[a])return t[a];return e[a]},_strToInt:function(t){return t?parseInt(t.substring(0,t.length-2)):!1},_optionTable:function(t,e,a){var s=this._getInst(t);return s.settings[a]},_getCellsTable:function(t,e,a){for(var s=this._getInst(t),l=s.settings.data,i=s.settings.colModel,n=[],d=0,o=0;o<i.length;o++)i[o].index===a.index&&(d=o);for(var r=0;r<l.length;r++)l[r][a.index]===a.value&&(a.col?n.push($("#"+s.id+"_"+a.col+"_"+r)):n.push($($($("#"+s.id+"subTable-1 tr").get(r)).find("td").get(d))));return n}}),$.fn.table=function(t){var e=Array.prototype.slice.call(arguments);return"option"!==t&&"getCells"!==t||2!=arguments.length?this.each(function(){return t.update?$.table._updateTable(this,t.update):"string"==typeof t?$.table["_"+t+"Table"].apply($.table,[this].concat(e)):$.table._attach(this,t)}):$.table["_"+t+"Table"].apply($.table,[this[0]].concat(e))},$.table=new Table,window["DP_jQuery_"+dpuuid]=$}(jQuery);