!function(e){e.fn.extend({table:{version:"0.0.1.0",author:"lly219@gmail.com"}});var t=(new Date).getTime(),s="table",a=function(){this._defaults={styleClass:{lineSelectedClass:"table-lineSelected",mainClass:"table-main",bodyClass:"table-body",headerClass:"table-header",lineHoverClass:"table-lineHover",sortClass:"table-sort",sortASCClass:"table-sortASC",sortDESCClass:"table-sortDESC",sortUnASCClass:"table-sortUnactiveASC",sortUnDESCClass:"table-sortUnactiveDESC",oddRowClass:"table-oddRow",evenRowClass:"table-evenRow",subTitleClass:"table-subTitle",subTitleHoverClass:"table-subTitleHover",subTitleShowClass:"table-subTitleShow",subTitleHideClass:"table-subTitleHide",expendRowClass:"table-expendRow",hasExpendClass:"table-hasExpend"}}};e.extend(a.prototype,{_attach:function(t,a){t.id||(this.uuid++,t.id="dp"+this.uuid);var i=this._newInst(e(t));i.settings=e.extend({length:0,noDataTip:"no data!",selectedRows:[]},a||{}),e.data(t,s,i),this._init(t)},_newInst:function(e){var t=e[0].id.replace(/([^A-Za-z0-9_])/g,"\\\\$1");return{id:t}},_getInst:function(t){try{return e.data(t,s)}catch(a){throw"Missing instance data for this table"}},_init:function(t){var s=this._getInst(t),a=s.settings;e(t).html("<div class='"+this._getDefaults(this._defaults,a,"styleClass").mainClass+"' id='"+s.id+"Table'></div>"),this._build(t)},_build:function(t){var s=this._getInst(t),a=s.settings,i=s.id,l=this._getDefaults(this._defaults,a,"styleClass"),n="<div id='"+i+"TableHeader' class='"+l.headerClass+"'></div><div id='"+i+"TableMain' class='"+l.bodyClass+"' style='height:"+(a.height?a.height+"px":"auto")+"'></div>";e("#"+i+"Table").html(n),this._buildHeader(t),a.data&&(this._buildBody(t),this._bindEvent(t))},_buildHeader:function(s){for(var a=this._getInst(s).settings,i=a.colModel,l=this._getInst(s).id,n="<table cellpadding='0' cellspacing='0' style='width:100%'><tr>",d=0;d<i.length;d++){var o=l+"_"+i[d].index;n+=i[d].minWidth?"<th style='min-width:"+i[d].minWidth+"px;'>":"<th style='width:"+i[d].width+"px;'>",n+="checkbox"===i[d].type?i[d].isLabel?i[d].text:"<input id='"+o+"' onclick=\"DP_jQuery_"+t+".table._selectHeaderCheckbox(this);\" type='checkbox'/></th>":"<span id='"+o+"'>"+i[d].text?i[d].text:"</span></th>"}e("#"+l+"TableHeader").html(n+"</tr></table>")},_buildBody:function(t){for(var s=this._getInst(t).id,a=this._getInst(t).settings,i=a.data,l=this._getDefaults(this._defaults,a,"styleClass"),n="",d=0;d<i.length;d++)"all"!==i[d].groupName&&(n+="<div  id='"+s+"SubTitle"+d+"'class='"+l.subTitleClass+"'><div class='left "+l.subTitleShowClass+"'></div><div class='left'>"+i[d].groupName+"</div><div class='clear'></div></div>"),n+="<table id="+s+"SubTable"+d+" style='width:100%;' cellpadding='0' cellspacing='0'>"+this._buildData(t,i[d].groupData,d)+"</table>";e("#"+s+"TableMain").html(n)},_buildData:function(s,a,i){for(var l=this._getInst(s).id,n=this._getInst(s).settings,d=n.colModel,o=this._getDefaults(this._defaults,n,"styleClass"),r="",u=0;u<a.length;u++){var h=a[u],c="<tbody class='$CLASS'>",b="<tr>",f=o.oddRowClass;u%2===1&&(f=o.evenRowClass),n.expendRow&&(b='<tr class="'+o.hasExpendClass+'">'),h.uuuid=n.length++;for(var g=0;g<d.length;g++){var p=d[g].index,v=h[p],_=d[g].align?"text-align:"+d[g].align+";":"";if((void 0===v||null===v||""===e.trim(v))&&(v="&nbsp;"),0===u&&(_+=d[g].minWidth?"min-width:"+d[g].minWidth+"px;":"width:"+d[g].width+"px;"),b+="<td style='"+_+"'>",d[g].type){var C="",y="",w="",m=l+"_"+p+"_"+i+"_"+u;h[p].value&&(y="checked='checked'",c=c.replace("$CLASS",o.lineSelectedClass+" "+f),n.selectedRows.push(h)),h[p].disabled&&(w="disabled='disabled'"),C="<input name='"+l+"_"+p+"' id='"+m+"' type='"+d[g].type+"' onclick=\"DP_jQuery_"+t+'.table._selectCheckbox(this);" '+y+" "+w+"/>",v=C}d[g].style&&(v="<div style='"+d[g].style+"'>"+v+"</div>"),b+=v+"</td>"}if(r+=c.replace("$CLASS",f)+b+"</tr>",n.expendRow){var T=h[n.expendRow.index];void 0===T&&(T=""),r+="<tr class='none "+o.expendRowClass+" "+f+"'><td colspan='"+d.length+"'>"+T+"</td></tr>"}r+="</tbody>"}return 0===a.length&&(r="<tbody><tr><td align='center' colspan='"+d.length+"'>"+n.noDataTip+"</td></tr></tbody>"),r},_bindEvent:function(t){for(var s=this._getInst(t),a=s.id,i=s.settings,l=s.settings.colModel,n=this._getDefaults(this._defaults,i,"styleClass"),d=i.data,o=0;o<d.length;o++){"all"!==d[0].groupName&&e("#"+a+"SubTitle"+o).click(function(){var t=e(this).find("div")[0];-1!=t.className.indexOf(n.subTitleShowClass)?(t.className=t.className.replace(n.subTitleShowClass,n.subTitleHideClass),e(this).next().hide()):(t.className=t.className.replace(n.subTitleHideClass,n.subTitleShowClass),e(this).next().show())}).mouseover(function(){this.className=n.subTitleHoverClass}).mouseout(function(){this.className=n.subTitleClass});for(var r=i.bind?i.bind:[],u=d[o].groupData,h=0;h<u.length;h++){for(var c=e(e("#"+a+"SubTable"+o+" tbody")[h]),b=0;b<r.length;b++)c.bind(r[b].type,{groupData:u[h],bindNum:b},function(e){r[e.data.bindNum].action(e,e.data.groupData)});c.mouseover(function(){e(this).hasClass(n.lineHoverClass)||(e("#"+a+" tbody").each(function(){e(this).removeClass(n.lineHoverClass),2===e(this).find("tr").length&&(e(this).find("tr")[1].style.display="none")}),e(this).addClass(n.lineHoverClass),2===e(this).find("tr").length&&(e.browser.msie?e.browser.version>7&&(e(this).find("tr")[1].style.display="block"):e(this).find("tr")[1].style.display="table-row"))});for(var f=0;f<l.length;f++)if(l[f].bind)for(var g=l[f].bind,p=0;p<g.length;p++)e(c.find("td")[f]).bind(g[p].type,{groupData:u[h],bindNum:p,colNum:f},function(e){l[e.data.colNum].bind[e.data.bindNum].action(e,e.data.groupData)})}}},_selectHeaderCheckbox:function(t){for(var a=t.id.split("_")[0],i=t.id.split("_")[1],l=e("#"+a).data(s).settings,n=l.data,d=this._getDefaults(this._defaults,l,"styleClass"),o=0;o<n.length;o++)for(var r=n[o].groupData,u=0;u<r.length;u++){var h=e("#"+a+"_"+i+"_"+o+"_"+u);h.prop("disabled")===!1&&(t.checked?l.selectedRows.push(r[u]):l.selectedRows.splice(u,1),h.prop("checked",t.checked))}t.checked?e("#"+a+"TableMain tbody").addClass(d.lineSelectedClass):e("#"+a+"TableMain tbody").removeClass(d.lineSelectedClass),e.unique(l.selectedRows)},_selectCheckbox:function(t){var a=t.id.split("_")[0],i=t.id.split("_")[1],l=t.id.split("_")[2],n=t.id.split("_")[3],d=e("#"+a).data(s).settings,o=d.data,r=this._getDefaults(this._defaults,d,"styleClass"),u=e("#"+a+"_"+i),h=e(e("#"+a+"SubTable"+l+" tbody")[n]);if(t.checked)h.addClass(r.lineSelectedClass),d.selectedRows.push(o[l].groupData[n]);else{h.removeClass(r.lineSelectedClass);for(var c in d.selectedRows)d.selectedRows[c].uuuid===o[l].groupData[n].uuuid&&d.selectedRows.splice(c,1)}d.selectedRows.length===d.length?u.prop("checked",!0):u.prop("checked",!1)},_getRow:function(t,s,a){var i={};for(var l in s){var n=s[l].groupData;for(var d in n)a===n[d].uuuid&&(i.data=n[d],i.$row=e(e("#"+t+"SubTable"+l+" tbody")[d]))}return i},_getDefaults:function(e,t,s){if("styleClass"===s){if("default"===t.theme||void 0===t.theme)return e.styleClass;t.styleClass={};for(var a in e[s])t.styleClass[a]=t.theme+"-"+e.styleClass[a]}else if(null===t[s]||void 0===t[s])return e[s];return t[s]},_strToInt:function(e){return e?parseInt(e.substring(0,e.length-2)):!1},_updateTable:function(t,s,a){var i=this._getInst(t),l=i.id,n=i.settings;if(a){var d=n.data,o=n.colModel,r=this._getRow(l,d,s);e.extend(r.data,a);for(var u=0;u<o.length;u++)if("checkbox"!==o[u].type){var h=o[u].index;r.$row.find("td")[u].innerHTML=r.data[h]?r.data[h]:"&nbsp;"}n.expendRow&&e(r.$row.find("tr")[1]).find("td").html(a[n.expendRow.index]?a[n.expendRow.index]:"&nbsp;")}else if(s.height){var c=s.height;e("#"+l+"TableMain").height(c),n.height=c}else n.data=s.data,this._build(t)},_getRowsTable:function(e,t,s){var a=this._getInst(e),i=a.settings;if(!t)return i.selectedRows;for(var l=[],n=0;n<i.data.length;n++){var d=i.data[n].groupData;for(var o in d)d[o][t]===s&&l.push(d[o])}return l},_destroyTable:function(t){var a=this._getInst(t);e.removeData(t,s),e("#"+a.id).remove()},_selectedTable:function(t,s){var a=this._getInst(t),i=a.id,l=a.settings,n=a.settings.data,d=this._getDefaults(this._defaults,l,"styleClass");for(var o in n){var r=n[o].groupData;for(var u in r)if(s===r[u].uuuid){l.selectedRows.push(r[u]),e.unique(l.selectedRows);var h=e(e("#"+i+"SubTable"+o+" tbody")[u]);h.addClass(d.lineSelectedClass),h.find("input").prop("checked",!0)}}},_unSelectedTable:function(t,s){var a=this._getInst(t),i=a.id,l=a.settings,n=a.settings.data,d=this._getDefaults(this._defaults,l,"styleClass");for(var o in n){var r=n[o].groupData;for(var u in r)if(s===r[u].uuuid){for(var h=l.selectedRows,c=0;c<h.length;c++)h[c].uuuid===s&&h.splice(c,1);var b=e(e("#"+i+"SubTable"+o+" tbody")[u]);b.removeClass(d.lineSelectedClass),b.find("input").prop("checked",!1)}}}}),e.fn.table=function(t){var s=Array.prototype.slice.call(arguments);return"string"==typeof t?(s.shift(),e.table["_"+t+"Table"].apply(e.table,[this[0]].concat(s))):this.each(function(){e.table._attach(this,t)})},e.table=new a,window["DP_jQuery_"+t]=e}(jQuery);