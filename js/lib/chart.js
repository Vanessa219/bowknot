/*
 * Copyright (C) 2011, Liyuan Li
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function(a){a.fn.extend({chart:{version:"0.0.0.8",author:"lly219@gmail.com"}});var b=(new Date).getTime(),c="chart",d=17,e=function(){this._defaults={bgColors:["#FDEADA","#DBEEF3","#E5E0EC","#EBF1DD","#FFCBCC","#FBD5B5","#B7DDE8","#CCC1D9","#D7E3BC","#FF9999","#FAC08F","#92CDDC","#B2A2C7","#C3D69B","#FF6566","#E36C09","#31859B","#5F487A"],styleClass:{hbPicClass:"chart-hb-pic",hbCountClass:"chart-hb-count",hbBarClass:"chart-bh-bar",panelClass:"chart-panel",vbBarClass:"chart-vb-bar",vbPicClass:"chart-vb-pic",vbMarkClass:"chart-vb-mark"}},this._settingsDataFormat={}};a.extend(e.prototype,{_attach:function(b,d){b.id||(this.uuid++,b.id="dp"+this.uuid);var e=this._newInst(a(b));e.settings=a.extend({},d||{}),a.data(b,c,e),this._init(b)},_newInst:function(a){var b=a[0].id.replace(/([^A-Za-z0-9_])/g,"\\\\$1");return{id:b}},_getInst:function(b){try{return a.data(b,c)}catch(d){throw"Missing instance data for this chart"}},_destroyChart:function(){},_init:function(b){var c=this._getInst(b),d=c.id,e=c.settings;a("#"+d).html("<div id='"+d+"Chart' style='height:"+e.height+"px;width:"+e.width+"px' class='"+a.chart._getDefaults(this._defaults,e,"styleClass").panelClass+"'></div>");switch(e.type){case"hb":this._horizontalBar(d+"Chart",e);break;case"vb":this._verticalBar(d+"Chart",e);break;default:alert("type is error!")}},_verticalBar:function(b,c){var d=a.chart._defaults.bgColors,e=c.data,f=c.loading,g=a.chart._getDefaults(this._defaults,c,"styleClass"),h=this._getMaxCount(e),i=30,j=c.width-32,k=c.height-36,l=Math.floor(j/e.length*2/3-2),m="",n="margin:0 "+Math.floor(j/e.length/6)+"px; ",o="";for(var p=0;p<e.length;p++){var q=e[p].title,r=e[p].count,s=d[p%18],t="",u=Math.floor(r*k/h),v=k-u;h<=0&&(v=k),r>-1&&(t="<span>"+r+"</span>"+"<div class='"+g.vbPicClass+"' style='width:"+l+"px;background-color:"+s+"; height:"+u+"px;'></div>");for(var w=0;w<f.length;w++)f[w]===q.toString()&&(t=c.loadingHTML?c.loadingHTML:"loading...",v=k);m+="<div class='left "+g.vbBarClass+"' style='"+n+"margin-top:"+v+"px;width:"+l+"px'>"+t+"<div>"+q+"</div></div>"}if(e.length>0){o="<div class='"+g.vbMarkClass+"' style='width:"+i+"px;' class='left'>";for(var x=5;x>0;x--){var y=k/5-5;x==5?o+="<div>"+h+"</div>":x==1?o+="<div style='margin-top:"+y+"px'>0</div>":o+="<div style='margin-top:"+y+"px'>"+Math.ceil(h/5)*x+"</div>"}}document.getElementById(b).innerHTML=o+"</div>"+m},_horizontalBar:function(b,c){var e=a.chart._defaults.bgColors,f=c.data,g=c.loading?c.loading:[],h=a.chart._getDefaults(this._defaults,c,"styleClass"),i=this._getMaxCount(f),j=Math.floor(c.width*2/5-2-d),k=Math.floor(c.width*3/5),l="";for(var m=0;m<f.length;m++){var n=f[m].title,o="",p=f[m].count,q="",r=Math.floor(p*k/i),s=e[m%18];n.length>7?(o=n.substr(0,6),o+="..."):o=n,p>-1&&(q="<div class='left "+h.hbPicClass+"' style='background-color:"+s+"; width:"+r+"px'>"+"</div>");for(var t=0;t<g.length;t++)g[t]===n&&(q=c.loadingHTML?c.loadingHTML:"loading...");l+="<div class='"+h.hbBarClass+"'><span class='left' style='width:"+j+"px' title='"+n+"'>"+o+"ï¼š<span class='"+h.hbCountClass+"'>"+p+"</span></span>"+q+"<div class='clear'></div></div>"}document.getElementById(b).innerHTML=l+"<div class='clear'></div>",a("#"+b).attr("scrollHeight")<a("#"+b).attr("clientHeight")&&a("#"+b).css("margin-left",d/2)},_getMaxCount:function(b){var c=[];for(var d=0;d<b.length;d++)c[d]=b[d].count;return a.chart._getMaxNumber(c)},_getMaxNumber:function(b){b.sort(a.chart._sortNumber);return b[b.length-1]},_sortNumber:function(a,b){return a-b},_getDefaults:function(a,b,c){if(c==="styleClass"){if(b.theme==="default"||b.theme===undefined)return a.styleClass;b.styleClass={};for(var d in a[c])b.styleClass[d]=b.theme+"-"+a.styleClass[d]}else{if(c==="height"&&b[c]!=="auto"||c==="width")return b[c]===null||b[c]===undefined?a[c]+"px":b[c]+"px";if(b[c]===null||b[c]===undefined)return a[c]}return b[c]}}),a.fn.chart=function(b){var c=Array.prototype.slice.call(arguments);return this.each(function(){typeof b=="string"?a.chart["_"+b+"Chart"].apply(a.chart,[this].concat(c)):a.chart._attach(this,b)})},a.chart=new e,window["DP_jQuery_"+b]=a})(jQuery)