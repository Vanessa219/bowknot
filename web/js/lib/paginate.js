/*
 * Copyright (C) 2011 Liyuan Li
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function(a){a.fn.extend({paginate:{version:"0.0.0.3",author:"lly219@gmail.com"}});var b=(new Date).getTime(),c="paginate",d=function(){this._defaults={styleClass:{pageCountClass:"paginate-pageCount",goPageClass:"paginate-goPage",inputPageClass:"paginate-inputPage",goPageHoverClass:"paginate-goPageHover",prePageClass:"paginate-prePage",nextPageClass:"paginate-nextPage",prePageDisableClass:"paginate-prePageDisable",nextPageDisableClass:"paginate-nextPageDisable",prePageHoverClass:"paginate-prePageHover",nextPageHoverClass:"paginate-nextPageHover",paginateClass:"paginate-paginate"}}};a.extend(d.prototype,{_attach:function(b,d){b.id||(this.uuid++,b.id="dp"+this.uuid);var e=this._newInst(a(b));e.settings=a.extend({errorMessage:"input error!"},d||{}),a.data(b,c,e),this._init(b)},_newInst:function(a){var b=a[0].id.replace(/([^A-Za-z0-9_])/g,"\\\\$1");return{id:b}},_getInst:function(b){try{return a.data(b,c)}catch(d){throw"Missing instance data for this paginate"}},_init:function(b){var c=this._getInst(b),d=c.id,e=c.settings;a("#"+d).html("<div id='"+d+"Paginate' class='"+this._getDefaults(a.paginate._defaults,e,"styleClass").paginateClass+"'></div>"),this._build(b)},_build:function(b){var c=this._getInst(b),d=c.id,e=c.settings,f=this._getDefaults(this._defaults,e,"styleClass"),g=e.pageCount,h=e.currentPage,i="<$tagStart class='button paginate-page'>\n                <span class='button-left'></span>\n                <span class='button-bg'>上一页</span>\n                <span class='button-right'></span>\n            </$tagEnd>",j="<$tagStart class='button paginate-page'>\n                <span class='button-left'></span>\n                <span class='button-bg'>下一页</span>\n                <span class='button-right'></span>\n            </$tagEnd>",k="",l="<span class='"+f.pageCountClass+"'>"+h+"/"+g+"</span>",m="<div class='button'>\n                <span class='button-left'></span>\n                <span class='button-bg'>\n                    <input class='"+f.inputPageClass+"' id='"+d+"PaginateInput'/>\n                </span>\n                <span class='button-right'></span>\n            </div>\n            <a href='javascript:void(0);' class='button' id='"+d+"PaginateSubmit'>\n                <span class='button-left'></span>\n                <span class='button-bg'>跳转</span>\n                <span class='button-right'></span>\n            </a>";h!==1?i=i.replace("$tagStart","a href='javascript:void(0)'").replace("$tagEnd","a"):i=i.replace("$tagStart","div").replace("$tagEnd","div"),h!==g?j=j.replace("$tagStart","a href='javascript:void(0)'").replace("$tagEnd","a"):j=j.replace("$tagStart","div").replace("$tagEnd","div");switch(e.type){case"taobao":var n=this._getTaobaoPages(h,g),o="";m="",l="";for(var p=0;p<n.length;p++)h===n[p].pageNum?o=" pagination-current-page":o="",k+="<span data-page='"+n[p].pageNum+"' class='pagination-pages"+o+"'>"+n[p].text+"</span>";break;default:}a("#"+d+"Paginate").html(i+k+j+l+m),this._bindEvent(b)},_getTaobaoPages:function(a,b){var c=[],d=2,e=4,f=3,g=0,h=0,i=0;a>=e?(f=a-Math.ceil(e/2),h=a+Math.ceil(e/2)+1,h<b?g=h:g=b):a<e&&(h=a+Math.ceil(e/2)+1,h<b?g=h:g=b),f<3&&(f=3);for(d=f;d<=g;d++)c.push({pageNum:d,text:d});f>3&&(i=2+(f-2),c.unshift({pageNum:i,text:"..."})),b<2?d=a===0?0:1:d=2;for(;d>=1;d=d-1)c.unshift({pageNum:d,text:d});g<b&&(i=g+Math.ceil(e/2),i>b&&(i=b),c.push({pageNum:i,text:"..."}));return c},_bindEvent:function(b){var c=this._getInst(b),d=c.id;a("#"+d+"PaginateInput").bind("keypress",{target:b},function(b){b.keyCode===13&&a.paginate._goToPageAction(b)}),a("#"+d+"Paginate .pagination-pages").bind("click",{target:b,isPage:!0},function(b){a.paginate._goToPageAction(b)}),a("#"+d+"PaginateSubmit").bind("click",{target:b},this._goToPageAction),a("#"+d+"Paginate a.paginate-page").bind("click",{target:b,isPage:!0},function(b){a.paginate._goToPageAction(b)})},_goToPageAction:function(b){var c=b.data.target,d=a.paginate._getInst(c),e=d.id,f=d.settings,g=parseInt(a("#"+e+"PaginateInput").val());if(b.data.isPage){g=f.currentPage;var h=b.target.parentNode.innerText?b.target.parentNode.innerText:b.target.parentNode.text;a.trim(h)==="上一页"?g--:a.trim(h)==="下一页"?g++:g=parseInt(a(b.target).data("page"))}f.currentPage!==g&&(g>0&&g<=f.pageCount?f.bind(g)&&(f.currentPage=g,a.paginate._updatePaginate(c)):(alert(f.errorMessage),a("#"+e+"PaginateInput").val("")))},_updatePaginate:function(b,c){c&&a.extend(this._getInst(b).settings,c),this._build(b)},_getDefaults:function(a,b,c){if(c==="styleClass"){if(b.theme==="default"||b.theme===undefined)return a.styleClass;b.styleClass={};for(var d in a[c])b.styleClass[d]=b.theme+"-"+a.styleClass[d]}else{if(c==="height"&&b[c]!=="auto"||c==="width")return b[c]===null||b[c]===undefined?a[c]+"px":b[c]+"px";if(b[c]===null||b[c]===undefined)return a[c]}return b[c]},_destroyPaginate:function(){}}),a.fn.paginate=function(b){var c=Array.prototype.slice.call(arguments);if(typeof b=="string"){c.shift();return a.paginate["_"+b+"Paginate"].apply(a.paginate,[this[0]].concat(c))}return this.each(function(){a.paginate._attach(this,b)})},a.paginate=new d,window["DP_jQuery_"+b]=a})(jQuery)