/*
 * Copyright (C) 2011, Liyuan Li
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(function($){$.fn.extend({dialog:{version:"0.0.1.4",author:"lly219@gmail.com"}});var k=new Date().getTime();var l='dialog';var m=function(){this._defaults={"styleClass":{"background":"dialog-background","panel":"dialog-panel","main":"dialog-main","footer":"dialog-footer","headerLeft":"dialog-header-left","headerRight":"dialog-header-right","headerMiddle":"dialog-header-middle","headerBg":"dialog-header-bg","closeIcon":"dialog-close-icon","closeIconHover":"dialog-close-icon-hover","title":"dialog-title","buttonRight":"dialog-button-right"}}};$.extend(m.prototype,{_attach:function(a,b){if(!a.id){this.uuid++;a.id='dp'+this.uuid}var c=this._newInst($(a));c.settings=$.extend({},b||{});$.data(a,l,c);this._init(a)},_newInst:function(a){var b=a[0].id.replace(/([^A-Za-z0-9_])/g,'\\\\$1');return{id:b}},_getInst:function(a){try{return $.data(a,l)}catch(err){throw'Missing instance data for this dialog';}},_destroyDialog:function(a){var b=$.dialog._getInst(a);var c=b.id;$.removeData(a,l);$(a).prependTo("#"+c+"Wrap").unwrap();$(a).removeAttr("style");var d=this._getDefaults($.dialog._defaults,b.settings,"styleClass");$("."+d.background).remove();$("#"+c+"Dialog").remove()},_init:function(a){var b=this._getInst(a);var c=b.id,settings=b.settings;var d=this._getDefaults($.dialog._defaults,settings,"styleClass"),height=settings.height,width=settings.width;settings.title=settings.title?settings.title:"";settings.okText=settings.okText?settings.okText:"Ok";settings.cancelText=settings.cancelText?settings.cancelText:"Cancel";var e="",headerHTML="<div class='"+d.headerLeft+"'></div><div class='"+d.headerBg+"' style='width: "+(width+18)+"px;'><div class='"+d.title+"' onselectstart='return false;'>"+settings.title+"</div><a href='javascript:void(0);' class='"+d.closeIcon+"'></a></div><div class='"+d.headerRight+"'></div><div class='clear'></div>";if(!settings.hideFooter){e="<a href='javascript:void(0);'><span>"+settings.okText+"</span><span class='"+d.buttonRight+"'></span></a><a href='javascript:void(0);'><span>"+settings.cancelText+"</span><span class='"+d.buttonRight+"'></span></a>"}var f="<div id='"+c+"Dialog' class='"+d.panel+"' style='width: "+(width+26)+"px;'><div>"+headerHTML+"</div><div class='"+d.main+"'><div style='overflow: auto; height: "+height+"px; width: "+width+"px;'></div><div class='"+d.footer+"'>"+e+"</div><div class='clear'></div></div>";var g="";if(settings.modal&&$("."+d.background).length===0){var h=$(window).height()<$("body").height()?$("body").height():$(window).height();g="<div style='height:"+h+"px;' class='"+d.background+"'></div>"}$("#"+c).wrap("<div id='"+c+"Wrap'></div>");var i=$(a).clone(true);$(a).remove();$('body').append(g+f);$($("#"+c+"Dialog ."+d.main+" div").get(0)).append(i);$(i).show();$("#"+c+"Dialog").css({"top":settings.position.top,"left":settings.position.left});$("#"+c+"Dialog ."+d.closeIcon).bind("click",function(){$.dialog._close(c,settings)});var j=$("#"+c+"Dialog ."+d.footer+" a");$(j.get(1)).bind("click",function(){$.dialog._close(c,settings)});$(j.get(0)).bind("click",function(){if(settings.ok===undefined||settings.ok()){$.dialog._close(c,settings)}});this._bindMove(c,d.headerBg,height,width);$(window).resize(function(){$("."+d.background).height($(window).height())})},_bindMove:function(f,g,h,i){$("#"+f+"Dialog ."+g).mousedown(function(c){var d=document;if(!c){c=window.event}var e=document.getElementById(f+"Dialog");var x=c.clientX-parseInt(e.style.left),y=c.clientY-parseInt(e.style.top);d.ondragstart="return false;";d.onselectstart="return false;";d.onselect="document.selection.empty();";if(this.setCapture){this.setCapture()}else if(window.captureEvents){window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP)}d.onmousemove=function(a){if(!a){a=window.event}var b=a.clientX-x,positionY=a.clientY-y;if(b<0){b=0}if(b>$(window).width()-$(e).width()){b=$(window).width()-$(e).width()}if(positionY<0){positionY=0}if(positionY>$(window).height()-$(e).height()){positionY=$(window).height()-$(e).height()}e.style.left=b+"px";e.style.top=positionY+"px"};d.onmouseup=function(){if(this.releaseCapture){this.releaseCapture()}else if(window.captureEvents){window.captureEvents(Event.MOUSEMOVE|Event.MOUSEUP)}d.onmousemove=null;d.onmouseup=null;d.ondragstart=null;d.onselectstart=null;d.onselect=null}})},_close:function(a,b){if(b.close===undefined||b.close()){$("#"+a+"Dialog").hide();if(b.modal){var c=this._getDefaults($.dialog._defaults,b,"styleClass");$("."+c.background).hide()}}},_closeDialog:function(a){var b=this._getInst(a);var c=b.id,settings=b.settings;$.dialog._close(c,settings)},_openDialog:function(a){var b=this._getInst(a);var c=b.id,settings=b.settings;$("#"+c+"Dialog").show();if(settings.modal){var d=this._getDefaults($.dialog._defaults,settings,"styleClass");$("."+d.background).show()}},_updateDialog:function(a,b){var c=this._getInst(a);var d=c.id,settings=c.settings;var e=this._getDefaults($.dialog._defaults,settings,"styleClass");$.extend(settings,b);var f=$("#"+d+"Dialog");if(b.position){f.css({"top":b.position.top,"left":b.position.left})}if(b.width){f.width(b.width+26);f.find("."+e.main+" div")[0].style.width=b.width+"px";f.find("."+e.headerBg).width(b.width+18)}if(b.height){f.find("."+e.main+" div")[0].style.height=b.height+"px"}if(b.title){f.find("."+e.title).html(b.title)}if(b.modal!==undefined){if(b.modal){$("."+e.background).show()}else{$("."+e.background).hide()}}if(b.hideFooter!==undefined){if(b.hideFooter){f.find("."+e.footer).hide()}else{f.find("."+e.footer).show()}}},_getDefaults:function(a,b,c){if(c==="styleClass"){if(b.theme==="default"||b.theme===undefined){return a.styleClass}b.styleClass={};for(var d in a[c]){b.styleClass[d]=b.theme+"-"+a.styleClass[d]}}else if(c==="height"||c==="width"){if(b[c]===null||b[c]===undefined){return"auto"}else{return b[c]+"px"}}else{if(b[c]===null||b[c]===undefined){return a[c]}}return b[c]}});$.fn.dialog=function(a){var b=Array.prototype.slice.call(arguments);if(typeof a==='string'){b.shift();return $.dialog['_'+a+'Dialog'].apply($.dialog,[this[0]].concat(b))}return this.each(function(){$.dialog._attach(this,a)})};$.dialog=new m();window['DP_jQuery_'+k]=$})(jQuery);