<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Path Editing</title>
    <link rel="stylesheet" href="../css/style.css">
    <script type="text/javascript" src="../../dist/paper-full.js"></script>
    <script type="text/paperscript" canvas="canvas">
        var values = {
            paths: 1,
            minPoints: 4,
            maxPoints: 4,
            minRadius: 100,
            maxRadius: 100
        };

        var hitOptions = {
            segments: true,
            stroke: true,
            fill: true,
            tolerance: 5
        };

        var radiusDelta = values.maxRadius - values.minRadius;
        var pointsDelta = values.maxPoints - values.minPoints;
        for (var i = 0; i < values.paths; i++) {
            var radius = values.minRadius + Math.random() * radiusDelta;
            var points = values.minPoints + Math.floor(Math.random() * pointsDelta);
            var path = createBlob(view.size * Point.random(), radius, points);
            var lightness = (Math.random() - 0.5) * 0.4 + 0.4;
            var hue = Math.random() * 360;
            path.fillColor = { hue: hue, saturation: 1, lightness: lightness };
            path.strokeColor = 'black';
        };
        

        function createBlob(center, maxRadius, points) {
            var path = new Path();
            path.closed = true;
            for (var i = 0; i < points; i++) {
                var delta = new Point({
                    length: (maxRadius * 0.5),
                    angle: (360 / points) * i - 45
                });
                path.add(center + delta);
            }
            return path;
        }

        var hitTest;
        function onMouseDown(event) {
            hitTest = project.hitTest(event.point, hitOptions);

            if (event.modifiers.shift) {
                if (hitTest.type == 'segment') {
                    hitTest.segment.remove();
                };
                return;
            }

            if (hitTest) {
                if (hitTest.type == 'segment') {
                    
                } else if (hitTest.type == 'stroke') {
//                    var location = hitTest.location;
//                    segment = path.insert(location.index + 1, event.point);
                } else if (hitTest.type == 'fill') {
                   
                }
                hitTest.item.bringToFront();
            }
        }

        function onMouseMove(event) {
            var hitResult = project.hitTest(event.point, hitOptions);
            project.activeLayer.selected = false;
            if (hitResult && hitResult.item)
                hitResult.item.selected = true;
        }

        function onMouseDrag(event) {
            if (hitTest.type == 'segment') {
                // TODO: add line
                // hitTest.segment.point += event.delta;
            } else if (hitTest.type == 'fill') {
                hitTest.item.position += event.delta;
            } else if (hitTest.type == 'stroke') {
                hitTest.location._segment1.point += event.delta;
                hitTest.location._segment2.point += event.delta;
            }
        }
        
        // TODO: click at stroke, add segment
        // var location = hitTest.location;
        // segment = path.insert(location.index + 1, event.point);
        // path.smooth();
    </script>
</head>
<body style="background:black">
    <canvas id="canvas" resize></canvas>
</body>
</html>
